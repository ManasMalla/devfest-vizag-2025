
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check for admin privileges by seeing if a
    // user's UID exists in the /admins collection.
    function isAdmin() {
      return exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }

    // Jobs can be read by anyone, but only written by admins.
    match /jobs/{jobId} {
      allow read: if true;
      allow write: if request.auth != null && isAdmin();
    }

    // Applications can only be created by authenticated users for themselves.
    // Reading applications is restricted to admins.
    // Updates and deletes are disallowed for everyone from the client-side.
    match /applications/{applicationId} {
      allow read: if request.auth != null && isAdmin();
      allow create: if request.auth != null && request.auth.uid == request.resource.data.userId;
      allow update, delete: if false;
    }

    // The admins collection is not writable from the client.
    // Admin access must be granted manually via the Firebase Console.
    // Admins can read the list of other admins.
    match /admins/{userId} {
      allow read: if request.auth != null && isAdmin();
      allow write: if false;
    }
  }
}
